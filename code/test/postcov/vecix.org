|       | 1 | 2 | 3 | 4 | 5 | 6 | 7 |  8 | 9 | 10 | 11 | 12 |
|-------+---+---+---+---+---+---+---+----+---+----+----+----|
| calc  | 1 | 1 | 0 | 1 | 0 | 1 | 1 |  1 | 1 |  0 |  1 |  0 |
|-------+---+---+---+---+---+---+---+----+---+----+----+----|

| icalc | 1 | 2 |  4 | 6 | 7 | 8 | 9 | 11 |
|-------+---+---+----+---+---+---+---+----|
| u1    | 1 | 4 |  7 |   |   |   |   |    |
| u2    | 2 | 8 | 11 |   |   |   |   |    |
| u3    | 6 | 9 |    |   |   |   |   |    |

- calc : full matrix to submatrix
- icalc : submatrix to full matrix

|    | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 |
|----+---+---+---+---+---+---+---+---+---+----+----+----|
|    | x |   |   |   |   |   |   |   |   |    |    |    |
|    | x | x |   |   |   |   |   |   |   |    |    |    |
|----+---+---+---+---+---+---+---+---+---+----+----+----|
|  1 | 1 | 2 | 3 |   |   |   |   |   |   |    |    |    |
|  2 | 1 | 2 | 3 |   |   |   |   |   |   |    |    |    |
|  3 | 1 | 2 | 3 |   |   |   |   |   |   |    |    |    |
|  4 |   |   |   | 4 | 5 | 6 |   |   |   |    |    |    |
|  5 |   |   |   | 4 | 5 | 6 |   |   |   |    |    |    |
|  6 |   |   |   | 4 | 5 | 6 |   |   |   |    |    |    |
|  7 |   |   |   |   |   |   | 7 | 8 | 9 |    |    |    |
|  8 |   |   |   |   |   |   | 7 | 8 | 9 |    |    |    |
|  9 |   |   |   |   |   |   | 7 | 8 | 9 |    |    |    |
| 10 |   |   |   |   |   |   |   |   |   | 10 | 11 | 12 |
| 11 |   |   |   |   |   |   |   |   |   | 10 | 11 | 12 |
| 12 |   |   |   |   |   |   |   |   |   | 10 | 11 | 12 |
|----+---+---+---+---+---+---+---+---+---+----+----+----|

|    | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10    | 11    | 12    |
|----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-------+-------+-------|
|    | x   |     |     |     |     |     |     |     |     |       |       |       |
|    | x   | x   |     |     |     |     |     |     |     |       |       |       |
|----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-------+-------+-------|
|  1 | u11 | u12 | u13 |     |     |     |     |     |     |       |       |       |
|  2 | u21 | u22 | u33 |     |     |     |     |     |     |       |       |       |
|  3 | u31 | u32 | u33 |     |     |     |     |     |     |       |       |       |
|  4 |     |     |     | u44 | u45 | u46 |     |     |     |       |       |       |
|  5 |     |     |     | u54 | u55 | u56 |     |     |     |       |       |       |
|  6 |     |     |     | u64 | u65 | u66 |     |     |     |       |       |       |
|  7 |     |     |     |     |     |     | u77 | u78 | u79 |       |       |       |
|  8 |     |     |     |     |     |     | u87 | u88 | u89 |       |       |       |
|  9 |     |     |     |     |     |     | u97 | u98 | u99 |       |       |       |
| 10 |     |     |     |     |     |     |     |     |     | u1010 | u1011 | u1012 |
| 11 |     |     |     |     |     |     |     |     |     | u1110 | u1111 | u1112 |
| 12 |     |     |     |     |     |     |     |     |     | u1210 | u1211 | u1212 |
|----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-------+-------+-------|

|    | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 |
|----+---+---+---+---+---+---+---+---+---+----+----+----|
|    | x |   |   |   |   |   |   |   |   |    |    |    |
|    | x | x |   |   |   |   |   |   |   |    |    |    |
|  1 | 1 | 2 |   |   |   |   |   |   |   |    |    |    |
|  2 | 1 | 2 |   |   |   |   |   |   |   |    |    |    |
|  3 |   |   |   |   |   |   |   |   |   |    |    |    |
|  4 |   |   |   | 4 |   | 6 |   |   |   |    |    |    |
|  5 |   |   |   |   |   |   |   |   |   |    |    |    |
|  6 |   |   |   | 4 |   | 6 |   |   |   |    |    |    |
|  7 |   |   |   |   |   |   | 7 | 8 | 9 |    |    |    |
|  8 |   |   |   |   |   |   | 7 | 8 | 9 |    |    |    |
|  9 |   |   |   |   |   |   | 7 | 8 | 9 |    |    |    |
| 10 |   |   |   |   |   |   |   |   |   |    |    |    |
| 11 |   |   |   |   |   |   |   |   |   |    | 11 |    |
| 12 |   |   |   |   |   |   |   |   |   |    |    |    |
|----+---+---+---+---+---+---+---+---+---+----+----+----|

|    | 1 | 2 | 4 | 6 | 7 | 8 | 9 | 11 |
|----+---+---+---+---+---+---+---+----|
|  1 | 1 | 2 |   |   |   |   |   |    |
|  2 | 1 | 2 |   |   |   |   |   |    |
|  4 |   |   | 4 | 6 |   |   |   |    |
|  6 |   |   | 4 | 6 |   |   |   |    |
|  7 |   |   |   |   | 7 | 8 | 9 |    |
|  8 |   |   |   |   | 7 | 8 | 9 |    |
|  9 |   |   |   |   | 7 | 8 | 9 |    |
| 11 |   |   |   |   |   |   |   | 11 |
|----+---+---+---+---+---+---+---+----|

|    | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10    | 11    | 12    |
|----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-------+-------+-------|
|    | x-2 |     |     |     |     |     |     |     |     |       |       |       |
|    | x-1 | x-1 |     |     |     |     |     |     |     |       |       |       |
|----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-------+-------+-------|
|  1 | u11 | u12 | x13 |     |     |     |     |     |     |       |       |       |
|  2 | u21 | u22 | x23 |     |     |     |     |     |     |       |       |       |
|  3 | x31 | x32 | x33 |     |     |     |     |     |     |       |       |       |
|  4 |     |     |     | u44 | x45 | u46 |     |     |     |       |       |       |
|  5 |     |     |     | x54 | x55 | x56 |     |     |     |       |       |       |
|  6 |     |     |     | u64 | x65 | u66 |     |     |     |       |       |       |
|  7 |     |     |     |     |     |     | u77 | u78 | u79 |       |       |       |
|  8 |     |     |     |     |     |     | u87 | u88 | u89 |       |       |       |
|  9 |     |     |     |     |     |     | u97 | u98 | u99 |       |       |       |
| 10 |     |     |     |     |     |     |     |     |     | x1010 | x1011 | x1012 |
| 11 |     |     |     |     |     |     |     |     |     | x1110 | u1111 | x1112 |
| 12 |     |     |     |     |     |     |     |     |     | x1210 | x1211 | x1212 |
|----+-----+-----+-----+-----+-----+-----+-----+-----+-----+-------+-------+-------|

|        | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 |
|--------+---+---+---+---+---+---+---+---+---+----+----+----|
| calc   | 1 | 1 | 0 | 1 | 0 | 1 | 1 | 1 | 1 |  0 |  1 |  0 |
|--------+---+---+---+---+---+---+---+---+---+----+----+----|
| cumsum | 1 | 2 | 2 | 3 | 3 | 4 | 5 | 6 | 7 |  7 |  8 |  8 |

| calc1 | 1 | 1 | 1 | 0 |
| cum1  | 1 | 3 | 5 | 7 |

| calc2 | 1 | 0 | 1 | 1 |
| cum2  | 2 | 3 | 6 | 8 |

| calc3 | 0 | 1 | 1 | 0 |
| cum3  | 2 | 4 | 7 | 8 |

| icalc | 1 | 2 | 4 | 6 | 7 | 8 | 9 | 11 |

Full vectors
| d | = | u11 | u22 | x33 | u44 | x55 | u66 | u77 | u88 | u99 | x1010 | u1111 | x1212 |

| d21 | = | u21 | x54 | u87 | x1110 |
| d31 | = | x31 | u64 | u97 | x1210 |
| d32 | = | x32 | x65 | u98 | x1211 |

Compact vectors

| d | = | u11 | u22 | u44 | u66 | u77 | u88 | u99 | u1111 |

| d21 | = | u21 | u87 |

| d31 | = | u64 | u97 |

| d32 | = | u98 |

Vectors we have
| U | = | u1 | u2 | u4 | u6 | u7 | u8 | u9 | u11 |

ud0(calc)=sum(U.^2)

| u1 | u4 | u7 | x10 |
|----+----+----+-----|
|  1 |  3 |  5 |   0 |

| calc1 | 1 | 1 | 1 | 0 |
| cum1  | 1 | 3 | 5 | 7 |

U1(:,calc1)=U(:,cum1(calc1))

2:3:end
| u2 | x5 | u8 | u11 |
|----+----+----+-----|
|  2 |  0 |  6 | 8   |

U2(:,calc2)=U(:,cum2(calc2))

3:3:end
| x3 | u6 | u9 | x12 |
|  0 |  4 |  7 | 0   |

U3(:,calc3)=U(:,cum3(calc3))

ud0(icalc)=sum(u.^2)

u12=sum(U1.*U2)
u13=sum(U1.*U3)
u23=sum(U2.*U3)
